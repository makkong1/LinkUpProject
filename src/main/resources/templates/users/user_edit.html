<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>사용자 수정</title>
    <link rel="stylesheet" th:href="@{/js/css/user_edit.css}">

    <!-- CSRF 토큰을 메타 태그에 추가 -->
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />

    <!-- 밑에 스크립트랑 메타데이터 두개는 앞으로 계속 넣어야된다   -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/js/Js/session-timer2.js"></script>
    <script src="/js/Js/ssenotification.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script> <!-- Toastify 알림 라이브러리 -->

    <script>
        (function () {
            try {
                var savedTheme = localStorage.getItem('theme');
                var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                var theme = savedTheme || (prefersDark ? 'dark' : 'light');
                document.documentElement.setAttribute('data-theme', theme);
            } catch (e) { }
        })();
        document.addEventListener('DOMContentLoaded', function () {
            const userId = $('#userId').data('username');
            if (userId) {
                startSSENotifications(userId);
            }
        });
    </script>
</head>

<body>
    <div th:replace="header :: header(${user})"></div>
    <div id="userId" th:data-username="${user.uUsername}"></div> <!-- 사용자 ID를 data-username에 저장 -->
    <main class="ue-container">
        <section class="ue-card">
            <header class="ue-header">
                <h1 class="ue-title"><i class="fas fa-user-cog"></i> 사용자 수정</h1>
            </header>
            <form class="ue-form"
                th:action="${isSocialLogin} ? @{/social_users/{socialUserId}/edit(socialUserId=${socialUser.socialUserId})} : @{/users/{u_idx}/edit(u_idx=${users.uIdx})}"
                th:method="put">
                <div class="ue-field">
                    <label for="name">이름</label>
                    <input type="text" id="name" name="name"
                        th:value="${isSocialLogin} ? ${socialUser.name} : ${users.uUsername}" required />
                </div>
                <div class="ue-field">
                    <label for="email">이메일</label>
                    <input type="email" id="email" name="email"
                        th:value="${isSocialLogin} ? ${socialUser.email} : ${users.uEmail}" required />
                </div>
                <div class="ue-grid" th:if="${!isSocialLogin}">
                    <div class="ue-field">
                        <label for="uNickname">닉네임</label>
                        <input type="text" id="uNickname" name="uNickname" th:value="${users.uNickname}" required />
                    </div>
                    <div class="ue-field">
                        <label for="uTelephone">전화번호</label>
                        <input type="text" id="uTelephone" name="uTelephone" th:value="${users.uTelephone}" required />
                    </div>
                    <div class="ue-field">
                        <label for="uBirthday">생일</label>
                        <input type="date" id="uBirthday" name="uBirthday" th:value="${users.uBirthday}" required />
                    </div>
                </div>
                <div class="ue-grid" th:if="${isSocialLogin}">
                    <div class="ue-field">
                        <label for="provider">소셜 제공자</label>
                        <input type="text" id="provider" name="provider" th:value="${socialUser.provider}" readonly />
                    </div>
                    <div class="ue-field">
                        <label for="phone">전화번호</label>
                        <input type="text" id="phone" name="phone" th:value="${socialUser.phone}" required />
                    </div>
                    <div class="ue-field">
                        <label for="birthyear">출생년도</label>
                        <input type="text" id="birthyear" name="birthyear" th:value="${socialUser.birthyear}" />
                    </div>
                    <div class="ue-field">
                        <label for="gender">성별</label>
                        <input type="text" id="gender" name="gender" th:value="${socialUser.gender}" />
                    </div>
                </div>
                <div class="ue-actions">
                    <button type="submit" class="ue-submit"><i class="fas fa-save"></i> 수정</button>
                    <a th:href="@{/board}" class="ue-cancel"><i class="fas fa-arrow-left"></i>게시글보러가기</a>
                </div>
            </form>
        </section>
    </main>
</body>

</html>