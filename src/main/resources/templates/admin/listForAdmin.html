<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신고 관리 | LinkUp 관리</title>
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" th:href="@{/js/css/listForAdmin.css}">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="/js/Js/listForAdmin.js"></script>
    <script src="/js/Js/ssenotification.js"></script>

    <script>
        $(document).ready(function () {
            $('.select2').select2({
                width: '100%',
            });
        });
    </script>

</head>

<body>
    <!-- 헤더 -->
    <div th:replace="header :: header(${user})"></div>
    <div id="userId" th:data-username="${user.uUsername}"></div>

    <main class="admin-container">
        <header class="page-header">
            <h1 class="page-title">
                <i class="fas fa-flag"></i>
                신고 관리
            </h1>
            <p class="page-description">신고된 게시글 및 댓글 관리</p>
        </header>

        <!-- 네비게이션 탭 -->
        <div class="tabs">
            <button class="tab-btn" data-target="board-tab">
                <i class="fas fa-file-alt"></i>
                게시글 신고
            </button>
            <button class="tab-btn" data-target="comment-tab">
                <i class="fas fa-comment"></i>
                댓글 신고
            </button>
        </div>

        <!-- 게시글 신고 탭 내용 -->
        <div id="board-tab" class="tab-content">
            <div class="search-section">
                <div class="search-container">
                    <select id="search">
                        <option value="all">전체검색</option>
                        <option value="title">제목</option>
                        <option value="content">내용</option>
                        <option value="writer">작성자</option>
                    </select>
                    <input id="input_text" type="text" placeholder="검색어를 입력해주세요">
                    <button onclick="textSearch();">
                        <i class="fas fa-search"></i>
                        검색
                    </button>
                </div>

                <div class="boardCategory">
                    <select id="boardCategory" class="form-control select2">
                        <option value="GENERAL">일반</option>
                        <option value="INQUIRY">문의</option>
                        <option value="NOTICE">공지사항</option>
                    </select>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>번호</th>
                        <th>제목</th>
                        <th>카테고리</th>
                        <th>작성자</th>
                        <th>등록일</th>
                        <th>신고 수</th>
                        <th>신고 상태</th>
                        <th>작업</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="board, iterStat : ${boardList}" align="center"
                        th:style="'animation-delay: ' + ${iterStat.index * 0.05} + 's; animation: fadeInUp 0.4s ease-out forwards;'">
                        <td th:text="${board.bIdx}">번호</td>
                        <td>
                            <a th:href="@{/board/{id}(id=${board.bIdx})}" th:text="${board.title}">제목</a>
                        </td>
                        <td>
                            <span th:if="${board.category == 'GENERAL'}" class="category-badge category-general">
                                <i class="fas fa-list"></i> 일반
                            </span>
                            <span th:if="${board.category == 'INQUIRY'}" class="category-badge category-inquiry">
                                <i class="fas fa-question-circle"></i> 문의
                            </span>
                            <span th:if="${board.category == 'NOTICE'}" class="category-badge category-notice">
                                <i class="fas fa-bullhorn"></i> 공지사항
                            </span>
                        </td>
                        <td
                            th:text="${board.writer != null ? board.writer.getUNickname() : (board.socialUser != null ? board.socialUser.name : '익명 사용자')}">
                            작성자
                        </td>
                        <td th:text="${#dates.format(board.uploadTime, 'yyyy-MM-dd')}">작성일</td>
                        <td>
                            <span style="font-weight: 600; color: #ff6b6b;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span th:text="${board.report}">0</span>
                            </span>
                        </td>
                        <td>
                            <span th:if="${board.isDeleted == 'Y'}" class="status-badge status-deleted">
                                <i class="fas fa-trash"></i> 삭제됨
                            </span>
                            <span th:if="${board.isDeleted == 'R'}" class="status-badge status-reported">
                                <i class="fas fa-flag"></i> 신고
                            </span>
                            <span th:if="${board.isDeleted == 'N'}" class="status-badge status-normal">
                                <i class="fas fa-check-circle"></i> 정상
                            </span>
                        </td>
                        <td>
                            <button class="report-action-button" th:data-id="${board.bIdx}" data-action="delete"
                                th:if="${board.isDeleted == 'R'}">
                                <i class="fas fa-trash"></i> 삭제
                            </button>
                            <button class="report-action-button" th:data-id="${board.bIdx}" data-action="resolve"
                                th:if="${board.isDeleted == 'R' || board.isDeleted == 'Y'}">
                                <i class="fas fa-check"></i> 신고 해결
                            </button>
                        </td>
                    </tr>
                    <tr th:if="${boardList.content.isEmpty()}">
                        <td colspan="8">
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-inbox"></i>
                                </div>
                                <h3>신고된 게시글이 없습니다</h3>
                                <p>신고된 게시글이 있으면 여기에 표시됩니다.</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="pagination-container" th:if="${boardList.totalPages > 0}">
                <ul class="pagination">
                    <li th:classappend="${!boardList.hasPrevious() ? 'disabled' : ''}" class="page-item">
                        <a th:href="@{${boardList.hasPrevious() ? '/admin/listForAdminP?page=' + (boardList.pageable.pageNumber - 1) : '#'}}"
                            class="page-link">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    <li th:each="i : ${#numbers.sequence(0, boardList.totalPages - 1)}"
                        th:classappend="${boardList.pageable.pageNumber == i ? 'active' : ''}" class="page-item">
                        <a th:href="@{/admin/listForAdminP?page={page}(page=${i})}" class="page-link"
                            th:text="${i + 1}">1</a>
                    </li>
                    <li th:classappend="${!boardList.hasNext() ? 'disabled' : ''}" class="page-item">
                        <a th:href="@{${boardList.hasNext() ? '/admin/listForAdminP?page=' + (boardList.pageable.pageNumber + 1) : '#'}}"
                            class="page-link">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 댓글 신고 탭 내용 -->
        <div id="comment-tab" class="tab-content">
            <div class="search-section">
                <div class="search-container">
                    <select id="search_comment">
                        <option value="all_comment">전체검색</option>
                        <option value="content_comment">내용</option>
                        <option value="writer_comment">작성자</option>
                    </select>
                    <input id="input_text_comment" type="text" placeholder="검색어를 입력해주세요">
                    <button onclick="textSearch();">
                        <i class="fas fa-search"></i>
                        검색
                    </button>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>번호</th>
                        <th>작성자</th>
                        <th>댓글 내용</th>
                        <th>신고 수</th>
                        <th>작업</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="comment, iterStat : ${commentList}" align="center"
                        th:style="'animation-delay: ' + ${iterStat.index * 0.05} + 's; animation: fadeInUp 0.4s ease-out forwards;'">
                        <td th:text="${comment.c_idx}">번호</td>
                        <td th:text="${comment.c_writer}">작성자</td>
                        <td th:text="${comment.c_content}">댓글 내용</td>
                        <td>
                            <span style="font-weight: 600; color: #ff6b6b;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span th:text="${comment.c_report}">0</span>
                            </span>
                        </td>
                        <td>
                            <button class="comment-action-button btn-success" th:data-id="${comment.c_idx}"
                                data-action="resolve" title="신고 취소 처리">
                                <i class="fas fa-check"></i> 신고 해결
                            </button>
                            <button class="comment-action-button btn-danger" th:data-id="${comment.c_idx}"
                                data-action="delete" title="댓글 삭제">
                                <i class="fas fa-trash"></i> 댓글 삭제
                            </button>
                        </td>
                    </tr>
                    <tr th:if="${commentList.size == 0}">
                        <td colspan="5">
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-inbox"></i>
                                </div>
                                <h3>신고된 댓글이 없습니다</h3>
                                <p>신고된 댓글이 있으면 여기에 표시됩니다.</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="pagination-container" th:if="${commentList.totalPages > 0}">
                <ul class="pagination">
                    <li th:classappend="${!commentList.hasPrevious() ? 'disabled' : ''}" class="page-item">
                        <a th:href="@{/admin/listForAdminP(page=${commentList.pageable.pageNumber - 1})}"
                            class="page-link">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    <li th:each="i : ${#numbers.sequence(0, commentList.totalPages - 1)}"
                        th:classappend="${commentList.pageable.pageNumber == i ? 'active' : ''}" class="page-item">
                        <a th:href="@{/admin/listForAdminP(page=${i})}" class="page-link" th:text="${i + 1}">1</a>
                    </li>
                    <li th:classappend="${!commentList.hasNext() ? 'disabled' : ''}" class="page-item">
                        <a th:href="@{/admin/listForAdminP(page=${commentList.pageable.pageNumber + 1})}"
                            class="page-link">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </main>
</body>

</html>