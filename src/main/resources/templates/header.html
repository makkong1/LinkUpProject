<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>LinkUp</title>
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script> <!-- Toastify 알림 라이브러리 -->
</head>

<body>
    <header th:fragment="header(user)">
        <style>
            /* Header styles with light/dark support */
            :root[data-theme='light'] .site-header {
                background: #ffffff;
                border-bottom: 1px solid #e5e7eb;
                color: #22223b;
            }

            :root[data-theme='dark'] .site-header {
                background: #23262b;
                border-bottom: 1px solid #343a40;
                color: #f1f3f5;
            }

            .nav-container {
                max-width: 1100px;
                margin: 0 auto;
                padding: 12px 18px;
            }

            .site-nav {
                display: flex;
                align-items: center;
                gap: 16px;
            }

            .site-nav .brand {
                font-weight: 700;
                font-size: 1.2rem;
                text-decoration: none;
            }

            :root[data-theme='light'] .site-nav .brand {
                color: #4f8cff;
            }

            :root[data-theme='dark'] .site-nav .brand {
                color: #7ab8ff;
            }

            .site-nav .spacer {
                flex: 1;
            }

            .site-nav a {
                text-decoration: none;
                font-weight: 500;
            }

            :root[data-theme='light'] .site-nav a {
                color: #495057;
            }

            :root[data-theme='dark'] .site-nav a {
                color: #cfd6de;
            }

            .site-nav a:hover {
                text-decoration: underline;
            }

            .site-actions {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .site-nav button,
            .theme-toggle {
                border: none;
                border-radius: 20px;
                padding: 6px 12px;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                gap: 6px;
                font-weight: 600;
            }

            :root[data-theme='light'] .theme-toggle {
                background: #e7f0ff;
                color: #4f8cff;
            }

            :root[data-theme='dark'] .theme-toggle {
                background: #2f3b52;
                color: #dbe9ff;
            }

            :root[data-theme='light'] .logout-btn {
                background: linear-gradient(90deg, #4f8cff 0%, #38b6ff 100%);
                color: #fff;
            }

            :root[data-theme='dark'] .logout-btn {
                background: linear-gradient(90deg, #7ab8ff 0%, #38b6ff 100%);
                color: #0b1b2b;
            }
        </style>
        <div class="site-header">
            <div class="nav-container">
                <nav class="site-nav">
                    <a class="brand" href="/board">LinkUp</a>
                    <a href="/board">게시글보러가기</a>
                    <div class="spacer"></div>
                    <div class="site-actions" th:if="${user != null}">
                        <a th:href="@{/users/{idx}(idx=${user.uIdx})}"
                            th:text="${isSocial} ? ${user.name + '님의 마이페이지'} : ${user.uNickname + '님의 활동'}"></a>
                        <a th:href="@{/users/{idx}/editP(idx=${user.uIdx})}"
                            th:text="${isSocial} ? ${user.name + '님의 마이페이지'} : ${user.uNickname + '님의 마이페이지'}"></a>
                        <a th:href="@{/users/{idx}/notion(idx=${user.uIdx})}"
                            th:text="${isSocial} ? ${user.name + '님의 링크업 페이지'} : ${user.uNickname + '님의 링크업 페이지'}"></a>
                        <button type="button" id="globalThemeToggle" class="theme-toggle" aria-label="테마 전환">
                            <i class="fas fa-moon"></i>
                            <span class="toggle-text">다크 모드</span>
                        </button>
                        <form th:action="@{/users/logout}" method="post" style="display: inline">
                            <button type="submit" class="logout-btn">
                                로그아웃
                            </button>
                        </form>
                    </div>
                    <div class="site-actions" th:if="${user == null}">
                        <a href="/users/loginP">로그인</a>
                        <button type="button" id="globalThemeToggle" class="theme-toggle" aria-label="테마 전환">
                            <i class="fas fa-moon"></i>
                            <span class="toggle-text">다크 모드</span>
                        </button>
                    </div>
                </nav>
            </div>
        </div>
        <script>
            (function () {
                try {
                    if (!document.documentElement.getAttribute('data-theme')) {
                        var savedTheme = localStorage.getItem('theme');
                        var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                        var theme = savedTheme || (prefersDark ? 'dark' : 'light');
                        document.documentElement.setAttribute('data-theme', theme);
                    }
                } catch (e) { }
                var toggleBtn = document.getElementById('globalThemeToggle');
                if (!toggleBtn) return;
                function updateToggleUi() {
                    var isDark = (document.documentElement.getAttribute('data-theme') === 'dark');
                    var icon = toggleBtn.querySelector('i');
                    var text = toggleBtn.querySelector('.toggle-text');
                    if (isDark) {
                        icon.classList.remove('fa-moon');
                        icon.classList.add('fa-sun');
                        if (text) text.textContent = '라이트 모드';
                        toggleBtn.setAttribute('aria-label', '라이트 모드로 전환');
                    } else {
                        icon.classList.remove('fa-sun');
                        icon.classList.add('fa-moon');
                        if (text) text.textContent = '다크 모드';
                        toggleBtn.setAttribute('aria-label', '다크 모드로 전환');
                    }
                }
                updateToggleUi();
                toggleBtn.addEventListener('click', function () {
                    var current = document.documentElement.getAttribute('data-theme') || 'light';
                    var next = current === 'dark' ? 'light' : 'dark';
                    document.documentElement.setAttribute('data-theme', next);
                    try { localStorage.setItem('theme', next); } catch (e) { }
                    updateToggleUi();
                });
            })();
        </script>

        <!-- 알림 표시용 div (필요하면 숨길 수 있음) -->
        <div id="notification-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;"></div>
    </header>
</body>

</html>